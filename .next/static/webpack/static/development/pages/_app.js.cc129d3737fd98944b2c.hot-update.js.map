{"version":3,"file":"static/webpack/static\\development\\pages\\_app.js.cc129d3737fd98944b2c.hot-update.js","sources":["webpack:///./components/Layout.jsx","webpack:///./pages/_app.js"],"sourcesContent":["import { useState, useCallback } from \"react\";\r\n\r\nimport Link from \"next/link\";\r\nimport {\r\n  Button,\r\n  Layout,\r\n  Icon,\r\n  Input,\r\n  Avatar,\r\n  Tooltip,\r\n  Dropdown,\r\n  Menu\r\n} from \"antd\";\r\nimport getConfig from \"next/config\";\r\nimport { connect } from \"react-redux\";\r\nimport { withRouter } from \"next/router\";\r\nimport axios from \"axios\";\r\n\r\nimport Container from \"./Container\";\r\n\r\nimport { logout } from \"../store/store\";\r\nconst { publicRuntimeConfig } = getConfig();\r\n\r\nconst { Header, Content, Footer } = Layout;\r\n// icon 不能直接加样式,,这样的话每次都是用同一个样式，而不是每次渲染重新声明一个方法\r\nconst githubIconStyle = {\r\n  color: \"white\",\r\n  fontSize: 40,\r\n  display: \"block\",\r\n  paddingTop: 30,\r\n  marginRight: 20\r\n};\r\nconst footerStyle = {\r\n  textAlign: \"center\"\r\n};\r\nfunction MyLayout({ children, user, logout, router }) {\r\n  // console.log(children);\r\n  const [search, setSearch] = useState(\"\");\r\n  // useCallback只依赖setSearch，setSearch不会变的话，空数组和加了setSearch的效果一样\r\n  const handleSearchChange = useCallback(\r\n    evt => {\r\n      setSearch(evt.target.value);\r\n    },\r\n    [setSearch]\r\n  );\r\n\r\n  const handleOnSearch = useCallback(() => {\r\n    router.push(`/search?query=${search}`);\r\n  }, [search]);\r\n\r\n  const handleLogout = useCallback(() => {\r\n    logout();\r\n  }, [logout]);\r\n  // 不依赖任何props和state的内容，所以传入空数组\r\n  const handleGoOauth = useCallback(e => {\r\n    e.preventDefault();\r\n    axios\r\n      .get(`/prepare-auth?url=${router.asPath}`)\r\n      .then(resp => {\r\n        if (resp.status === 200) {\r\n          location.href = publicRuntimeConfig.OAUTH_URL;\r\n        } else {\r\n          console.log(\"prepare auth failed \", resp);\r\n        }\r\n      })\r\n      .catch(err => {\r\n        console.log(\"prepare auth failed \", err);\r\n      });\r\n  }, []);\r\n\r\n  const userDropdown = (\r\n    <Menu>\r\n      <Menu.Item>\r\n        <a href=\"\" onClick={handleLogout}>\r\n          登 出\r\n        </a>\r\n      </Menu.Item>\r\n    </Menu>\r\n  );\r\n\r\n  return (\r\n    <Layout>\r\n      <Header>\r\n        <Container renderer={<div className=\"header-inner\" />}>\r\n          <div className=\"header-left\">\r\n            <div className=\"logo\">\r\n              <Link href=\"/\">\r\n                <Icon type=\"github\" style={githubIconStyle} />\r\n              </Link>\r\n            </div>\r\n            <div>\r\n              <Input.Search\r\n                placeholder=\"搜索仓库\"\r\n                value={search}\r\n                onChange={handleSearchChange}\r\n                onSearch={handleOnSearch}\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className=\"header-right\">\r\n            <div className=\"user\">\r\n              {user && user.id ? (\r\n                <Dropdown overlay={userDropdown}>\r\n                  <a href=\"#\" onClick={e => e.preventDefault()}>\r\n                    <Avatar size={40} src={user.avatar_url} />\r\n                  </a>\r\n                </Dropdown>\r\n              ) : (\r\n                <Tooltip title=\"点击进行登录\">\r\n                  <a\r\n                    href={publicRuntimeConfig.OAUTH_URL}\r\n                    onClick={handleGoOauth}\r\n                  >\r\n                    <Avatar size={40} icon=\"user\" />\r\n                  </a>\r\n                </Tooltip>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </Container>\r\n      </Header>\r\n      <Content> indexlalalal</Content>\r\n      <Footer style={footerStyle}>\r\n        develop by dabao @\r\n        <a href=\"mailto:pistar@foxmail.com \">pistar@foxmail.com</a>\r\n      </Footer>\r\n\r\n      <style jsx>{`\r\n        .content {\r\n          color: red;\r\n        }\r\n\r\n        .header-inner {\r\n          display: flex;\r\n          justify-content: space-between;\r\n        }\r\n\r\n        .header-left {\r\n          display: flex;\r\n          justify-content: flex-start;\r\n        }\r\n      `}</style>\r\n\r\n      <style jsx global>{`\r\n        #__next {\r\n          height: 100%;\r\n        }\r\n\r\n        .ant-layout {\r\n          min-height: 100%;\r\n        }\r\n\r\n        .ant-layout-header {\r\n          padding-left: 0;\r\n          padding-right: 0;\r\n        }\r\n\r\n        .ant-layout-content {\r\n          background-color: white;\r\n        }\r\n      `}</style>\r\n    </Layout>\r\n  );\r\n}\r\n\r\nexport default connect(\r\n  function mapState(state) {\r\n    return {\r\n      user: state.user\r\n    };\r\n  },\r\n  function mapReducer(dispatch) {\r\n    return {\r\n      logout: () => dispatch(logout())\r\n    };\r\n  }\r\n)(withRouter(MyLayout));\r\n","// 本文件是用来修改nextjs默认环境的地方，每个页面都回去渲染这个组件，这是个渲染组件，\r\n// import App from \"next/app\";\r\nimport App, { Container } from \"next/app\";\r\nimport \"antd/dist/antd.css\";\r\nimport { Provider } from \"react-redux\";\r\n\r\nimport Layout from \"../components/Layout\";\r\nimport MyContext from \"../lib/my-context\";\r\nimport WithReduxApp from \"../lib/with-redux\";\r\nclass MyApp extends App {\r\n  state = {\r\n    context: \"value\"\r\n  };\r\n  static async getInitialProps(ctx) {\r\n    const { Component } = ctx;\r\n    console.log(\"app init\");\r\n\r\n    let pageProps = {};\r\n\r\n    if (Component.getInitialProps) {\r\n      pageProps = await Component.getInitialProps(ctx);\r\n    }\r\n\r\n    return { pageProps };\r\n  }\r\n  render() {\r\n    const { Component, pageProps, reduxStore } = this.props;\r\n    // console.log(Component, pageProps);\r\n    return (\r\n      <Provider store={reduxStore}>\r\n        <Layout>\r\n          <MyContext.Provider value={this.state.context}>\r\n            <Component {...pageProps} />\r\n          </MyContext.Provider>\r\n        </Layout>\r\n      </Provider>\r\n    );\r\n  }\r\n}\r\nexport default WithReduxApp(MyApp);\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;AAWA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AADA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AADA;AAAA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AAIA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AAAA;AAAA;AACA;AAMA;AAGA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAGA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAQA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAIA;AAAA;AAEA;AACA;AAFA;AAAA;AAIA;AAAA;AAAA;AASA;AAAA;AAEA;AAAA;AAAA;AA3CA;AAAA;AAAA;AAAA;AAkFA;AACA;AACA;AAEA;AACA;AADA;AAGA;AAEA;AACA;AAAA;AAAA;AADA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/KA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;AACA;AACA;AADA;AACA;;;;;;AAcA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AAEA;AAAA;AAMA;;;AAxBA;;;;;;AACA;AACA;AAEA;AACA;AACA;;;;;;AACA;AACA;;AADA;AACA;;AAEA;AAAA;AAAA;AACA;;;;;;;;;;;AAfA;AACA;AA6BA;;;;A","sourceRoot":""}